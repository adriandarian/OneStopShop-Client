(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{155:function(n,t,e){},182:function(n,t,e){"use strict";e.r(t);var r=e(4),a=e(139),c=e(219),i=e(0),o=e.n(i),u=e(21),s=e.n(u),d=e(15),l=(e(155),e(52)),b=e(20),f=e(5),j=e(9),h=e(98);function p(){var n=Object(f.a)(["\n  position: relative;\n  overflow: hidden;\n  height: 100vh;\n  width: 100vw;\n \n  > div {\n    position: absolute;\n    overflow: hidden;\n    height: 100vh;\n    width: 100vw;\n  }\n"]);return p=function(){return n},n}var v=h.a,g=function(n){return Object(h.b)(n,{stiffness:174,damping:24})},O=function(n){return{transform:"translateX(".concat(n.offset,"%)")}},m=Object(j.b)(v).attrs((function(){return{atEnter:{offset:100},atLeave:{offset:g(-100)},atActive:{offset:g(0)},mapStyles:O}}))(p()),x=e(23),y=e(47),C=e(63),w=e(22),k=e.n(w);function M(){var n=Object(f.a)(["\n  fragment Message on Message {\n    id\n    createdAt\n    content\n    isMine\n    chat {\n      id\n    }\n  }\n"]);return M=function(){return n},n}var I=k()(M());function S(){var n=Object(f.a)(["\n  fragment Chat on Chat {\n    id\n    name\n    picture\n    lastMessage {\n      ...Message\n    }\n  }\n  ","\n"]);return S=function(){return n},n}var $=k()(S(),I);function q(){var n=Object(f.a)(["\n  fragment MessagesResult on MessagesResult {\n    cursor\n    hasMore\n    messages {\n      ...Message\n    }\n  }\n  ","\n"]);return q=function(){return n},n}var A=k()(q(),I);function D(){var n=Object(f.a)(['\n  fragment FullChat on Chat {\n    ...Chat\n    messages(limit: $limit, after: $after) @connection(key: "messages") {\n      ...MessagesResult\n    }\n  }\n  ',"\n  ","\n"]);return D=function(){return n},n}var F=k()(D(),$,A);function R(){var n=Object(f.a)(["\n  fragment User on User {\n    id\n    name\n    picture\n  }\n"]);return R=function(){return n},n}var U=k()(R());function E(){var n=Object(f.a)(["\n  query Chats {\n    chats {\n        ...Chat\n    }\n  }\n  ","\n"]);return E=function(){return n},n}var _=k()(E(),$);function L(){var n=Object(f.a)(["\n    subscription MessageAdded {\n  messageAdded {\n    ...Message\n  }\n}\n    ",""]);return L=function(){return n},n}function P(){var n=Object(f.a)(["\n    subscription ChatRemoved {\n  chatRemoved\n}\n    "]);return P=function(){return n},n}function Q(){var n=Object(f.a)(["\n    subscription ChatAdded {\n  chatAdded {\n    ...Chat\n  }\n}\n    ",""]);return Q=function(){return n},n}function z(){var n=Object(f.a)(["\n    query Me {\n  me {\n    ...User\n  }\n}\n    ",""]);return z=function(){return n},n}function N(){var n=Object(f.a)(["\n    query Chats {\n  chats {\n    ...Chat\n  }\n}\n    ",""]);return N=function(){return n},n}function T(){var n=Object(f.a)(["\n    mutation signUp($name: String!, $username: String!, $password: String!, $passwordConfirm: String!) {\n  signUp(\n    name: $name\n    username: $username\n    password: $password\n    passwordConfirm: $passwordConfirm\n  ) {\n    id\n  }\n}\n    "]);return T=function(){return n},n}function H(){var n=Object(f.a)(["\n    mutation signIn($username: String!, $password: String!) {\n  signIn(username: $username, password: $password) {\n    id\n  }\n}\n    "]);return H=function(){return n},n}function B(){var n=Object(f.a)(["\n    query UsersList {\n  users {\n    ...User\n  }\n}\n    ",""]);return B=function(){return n},n}function G(){var n=Object(f.a)(["\n    mutation AddMessage($chatId: ID!, $content: String!) {\n  addMessage(chatId: $chatId, content: $content) {\n    ...Message\n  }\n}\n    ",""]);return G=function(){return n},n}function J(){var n=Object(f.a)(["\n    query GetChat($chatId: ID!, $limit: Int!, $after: Float) {\n  chat(chatId: $chatId) {\n    ...FullChat\n  }\n}\n    ",""]);return J=function(){return n},n}function W(){var n=Object(f.a)(["\n    mutation RemoveChat($chatId: ID!) {\n  removeChat(chatId: $chatId)\n}\n    "]);return W=function(){return n},n}function K(){var n=Object(f.a)(["\n    mutation AddChat($recipientId: ID!) {\n  addChat(recipientId: $recipientId) {\n    ...Chat\n  }\n}\n    ",""]);return K=function(){return n},n}function X(){var n=Object(f.a)(["\n    fragment User on User {\n  id\n  name\n  picture\n}\n    "]);return X=function(){return n},n}function V(){var n=Object(f.a)(['\n    fragment FullChat on Chat {\n  ...Chat\n  messages(limit: $limit, after: $after) @connection(key: "messages") {\n    ...MessagesResult\n  }\n}\n    ',"\n",""]);return V=function(){return n},n}function Y(){var n=Object(f.a)(["\n    fragment MessagesResult on MessagesResult {\n  cursor\n  hasMore\n  messages {\n    ...Message\n  }\n}\n    ",""]);return Y=function(){return n},n}function Z(){var n=Object(f.a)(["\n    fragment Chat on Chat {\n  id\n  name\n  picture\n  lastMessage {\n    ...Message\n  }\n}\n    ",""]);return Z=function(){return n},n}function nn(){var n=Object(f.a)(["\n    fragment Message on Message {\n  id\n  createdAt\n  content\n  isMine\n  chat {\n    id\n  }\n}\n    "]);return nn=function(){return n},n}var tn=Object(d.gql)(nn()),en=Object(d.gql)(Z(),tn),rn=Object(d.gql)(Y(),tn),an=Object(d.gql)(V(),en,rn),cn=Object(d.gql)(X()),on=Object(d.gql)(K(),en);var un=Object(d.gql)(W());var sn=Object(d.gql)(J(),an);var dn=Object(d.gql)(G(),tn);var ln=Object(d.gql)(B(),cn);var bn=Object(d.gql)(H());var fn=Object(d.gql)(T());var jn=Object(d.gql)(N(),en);var hn=Object(d.gql)(z(),cn);var pn=Object(d.gql)(Q(),en);var vn=Object(d.gql)(P());var gn=Object(d.gql)(L(),tn);var On=function(){var n;n={onSubscriptionData:function(n){var t=n.client,e=n.subscriptionData.data;e&&mn(t,e.messageAdded)}},d.useSubscription(gn,n),function(n){d.useSubscription(pn,n)}({onSubscriptionData:function(n){var t=n.client,e=n.subscriptionData.data;e&&xn(t,e.chatAdded)}}),function(n){d.useSubscription(vn,n)}({onSubscriptionData:function(n){var t=n.client,e=n.subscriptionData.data;e&&yn(t,e.chatRemoved)}})},mn=function(n,t){var e,r=Object(C.b)(t.chat);if(null!==r){try{e=n.readFragment({id:r,fragment:F,fragmentName:"FullChat"})}catch(u){return}if(null!==e&&null!==e.messages&&!e.messages.messages.some((function(n){return n.id===t.id}))){var a;e.messages.messages.push(t),e.lastMessage=t,n.writeFragment({id:r,fragment:F,fragmentName:"FullChat",data:e});try{a=n.readQuery({query:_})}catch(u){return}if(!a||null===a)return null;if(!a.chats||void 0===a.chats)return null;var c=a.chats,i=c.findIndex((function(n){var e;return null===t||null===t.chat?-1:n.id===(null===t||void 0===t||null===(e=t.chat)||void 0===e?void 0:e.id)}));if(-1!==i){var o=c[i];c.splice(i,1),c.unshift(o),n.writeQuery({query:_,data:{chats:c}})}}}},xn=function(n,t){var e=Object(C.b)(t);if(null!==e){var r;n.writeFragment({id:e,fragment:$,fragmentName:"Chat",data:t});try{r=n.readQuery({query:_})}catch(c){return}if(r){var a=r.chats;a&&(a.some((function(n){return n.id===t.id}))||(a.unshift(t),n.writeQuery({query:_,data:{chats:a}})))}}},yn=function(n,t){var e={__typename:"Chat",id:t},r=Object(C.b)(e);if(null!==r){var a;n.writeFragment({id:r,fragment:F,fragmentName:"FullChat",data:null});try{a=n.readQuery({query:_})}catch(o){return}if(a&&a.chats){var c=a.chats;if(c){var i=c.findIndex((function(n){return n.id===t}));-1!==i&&(c.splice(i,1),n.writeQuery({query:_,data:{chats:c}}))}}}},Cn=o.a.createContext(null),wn=function(n){return function(t){if(!Sn())return"/sign-in"===t.history.location.pathname?null:Object(r.jsx)(b.a,{to:"/sign-in"});var e,a=In(),c=d.useQuery(hn,e),i=c.data,o=c.error,u=c.loading;return On(),u||void 0===i?null:o||!i.me?(a(),Object(r.jsx)(b.a,{to:"/sign-in"})):Object(r.jsx)(Cn.Provider,{value:i.me,children:Object(r.jsx)(n,Object(y.a)({},t))})}},kn=function(n){return d.useMutation(bn,n)},Mn=function(n){return d.useMutation(fn,n)},In=function(){var n=Object(d.useApolloClient)();return Object(i.useCallback)((function(){return document.cookie="authToken=;expires=".concat(new Date(0)),n.clearStore()}),[n])},Sn=function(){return/authToken=.+(;|$)/.test(document.cookie)},$n=e(216),qn=e(220);function An(){var n=Object(f.a)(["\n  position: fixed;\n  color: red;\n  font-size: 15px;\n  margin-top: 20px;\n"]);return An=function(){return n},n}function Dn(){var n=Object(f.a)(["\n  width: 100px;\n  display: block !important;\n  margin: auto !important;\n  background-color: var(--secondary-bg) !important;\n \n  &[disabled] {\n    color: #38a81c;\n  }\n \n  &:not([disabled]) {\n    color: white;\n  }\n"]);return Dn=function(){return n},n}function Fn(){var n=Object(f.a)(["\n  width: 100%;\n  position: relative;\n \n  > div::before {\n    border-color: white !important;\n  }\n \n  input {\n    color: white !important;\n \n    &::placeholder {\n      color: var(--primary-bg) !important;\n    }\n  }\n \n  label {\n    color: white !important;\n  }\n"]);return Fn=function(){return n},n}function Rn(){var n=Object(f.a)(["\n  color: white;\n \n  &::placeholder {\n    color: var(--primary-bg);\n  }\n"]);return Rn=function(){return n},n}function Un(){var n=Object(f.a)(["\n  color: white !important;\n"]);return Un=function(){return n},n}function En(){var n=Object(f.a)(["\n  font-weight: bold;\n  color: white;\n"]);return En=function(){return n},n}function _n(){var n=Object(f.a)(["\n  padding-bottom: 35px;\n"]);return _n=function(){return n},n}function Ln(){var n=Object(f.a)(["\n  padding: 20px;\n"]);return Ln=function(){return n},n}function Pn(){var n=Object(f.a)(["\n  height: calc(100% - 265px);\n"]);return Pn=function(){return n},n}var Qn=j.b.div(Pn()),zn=j.b.form(Ln()),Nn=j.b.div(_n()),Tn=j.b.legend(En()),Hn=(j.b.label(Un()),j.b.input(Rn()),Object(j.b)(qn.a)(Fn())),Bn=Object(j.b)($n.a)(Dn()),Gn=j.b.div(An()),Jn=function(n){var t=n.history,e=Object(i.useState)(""),a=Object(x.a)(e,2),c=a[0],o=a[1],u=Object(i.useState)(""),s=Object(x.a)(u,2),d=s[0],l=s[1],b=Object(i.useState)(""),f=Object(x.a)(b,2),j=f[0],h=f[1],p=kn(),v=Object(x.a)(p,1)[0],g=Object(i.useCallback)((function(n){var t=n.target;h(""),o(t.value)}),[]),O=Object(i.useCallback)((function(n){var t=n.target;h(""),l(t.value)}),[]),m=Object(i.useCallback)((function(){return!(!c||!d)}),[c,d]),y=Object(i.useCallback)((function(){v({variables:{username:c,password:d}}).then((function(){t.replace("/chats")})).catch((function(n){h(n.message||n)}))}),[c,d,t,v]);return Object(r.jsx)(Qn,{children:Object(r.jsxs)(zn,{children:[Object(r.jsx)(Tn,{children:"Sign in"}),Object(r.jsxs)(Nn,{style:{width:"100%"},children:[Object(r.jsx)(Hn,{"data-testid":"username-input",label:"Username",value:c,onChange:g,margin:"normal",placeholder:"Enter your username"}),Object(r.jsx)(Hn,{"data-testid":"password-input",label:"Password",type:"password",value:d,onChange:O,margin:"normal",placeholder:"Enter your password"})]}),Object(r.jsx)(Bn,{"data-testid":"sign-in-button",type:"button",color:"secondary",variant:"contained",disabled:!m(),onClick:y,children:"Sign in"}),Object(r.jsx)(Gn,{"data-testid":"error-message",children:j})]})})},Wn=function(n){var t=n.history,e=Object(i.useState)(""),a=Object(x.a)(e,2),c=a[0],o=a[1],u=Object(i.useState)(""),s=Object(x.a)(u,2),d=s[0],l=s[1],b=Object(i.useState)(""),f=Object(x.a)(b,2),j=f[0],h=f[1],p=Object(i.useState)(""),v=Object(x.a)(p,2),g=v[0],O=v[1],m=Object(i.useState)(""),y=Object(x.a)(m,2),C=y[0],w=y[1],k=Mn(),M=Object(x.a)(k,1)[0],I=Object(i.useCallback)((function(n){var t=n.target;w(""),o(t.value)}),[]),S=Object(i.useCallback)((function(n){var t=n.target;w(""),l(t.value)}),[]),$=Object(i.useCallback)((function(n){var t=n.target;w(""),h(t.value)}),[]),q=Object(i.useCallback)((function(n){var t=n.target;w(""),O(t.value)}),[]),A=Object(i.useCallback)((function(){return!!(c&&d&&j&&j===g)}),[c,d,j,g]),D=Object(i.useCallback)((function(){M({variables:{username:d,password:j,passwordConfirm:g,name:c}}).then((function(){t.replace("/sign-in")})).catch((function(n){w(n.message||n)}))}),[c,d,j,g,t,M]);return Object(r.jsx)(Qn,{children:Object(r.jsxs)(zn,{children:[Object(r.jsx)(Tn,{children:"Sign up"}),Object(r.jsxs)(Nn,{style:{float:"left",width:"calc(50% - 10px)",paddingRight:"10px"},children:[Object(r.jsx)(Hn,{"data-testid":"name-input",label:"Name",value:c,onChange:I,autoComplete:"off",margin:"normal"}),Object(r.jsx)(Hn,{"data-testid":"username-input",label:"Username",value:d,onChange:S,autoComplete:"off",margin:"normal"})]}),Object(r.jsxs)(Nn,{style:{float:"right",width:"calc(50% - 10px)",paddingLeft:"10px"},children:[Object(r.jsx)(Hn,{"data-testid":"password-input",label:"Password",type:"password",value:j,onChange:$,autoComplete:"off",margin:"normal"}),Object(r.jsx)(Hn,{"data-testid":"password-confirm-input",label:"Confirm password",type:"password",value:g,onChange:q,autoComplete:"off",margin:"normal"})]}),Object(r.jsx)(Bn,{"data-testid":"sign-up-button",type:"button",color:"secondary",variant:"contained",disabled:!A(),onClick:D,children:"Sign up"}),Object(r.jsx)(Gn,{"data-testid":"error-message",children:C})]})})};function Kn(){var n=Object(f.a)(["\n  position: fixed;\n  bottom: 10px;\n  left: 10px;\n\n  label {\n    color: var(--secondary-bg);\n  }\n"]);return Kn=function(){return n},n}function Xn(){var n=Object(f.a)(["\n  width: 100%;\n  text-align: center;\n  color: white;\n"]);return Xn=function(){return n},n}function Vn(){var n=Object(f.a)(["\n  width: 125px;\n  height: auto;\n  margin-left: auto;\n  margin-right: auto;\n  padding-top: 70px;\n  display: block;\n"]);return Vn=function(){return n},n}function Yn(){var n=Object(f.a)(["\n  height: 265px;\n"]);return Yn=function(){return n},n}function Zn(){var n=Object(f.a)(["\n  background: radial-gradient(rgb(34, 65, 67), rgb(17, 48, 50)),\n    url(/assets/chat-background.jpg) no-repeat;\n  background-size: cover;\n  background-blend-mode: multiply;\n  color: white;\n"]);return Zn=function(){return n},n}var nt=j.b.div(Zn()),tt=j.b.div(Yn()),et=j.b.img(Vn()),rt=j.b.h2(Xn()),at=j.b.div(Kn()),ct=function(n){var t=n.history,e=n.location,a=Object(i.useMemo)((function(){if("/sign-in"===e.pathname){return Object(r.jsxs)(at,{children:["Don't have an account yet?"," ",Object(r.jsx)("label",{onClick:function(){t.replace("/sign-up")},children:"Sign up!"})]})}return Object(r.jsxs)(at,{children:["Already have an accout? ",Object(r.jsx)("label",{onClick:function(){t.replace("/sign-in")},children:"Sign in!"})]})}),[e.pathname,t]);return Object(r.jsxs)(nt,{className:"AuthScreen Screen",children:[Object(r.jsxs)(tt,{className:"AuthScreen-intro",children:[Object(r.jsx)(et,{src:"assets/whatsapp-icon.png",className:"AuthScreen-icon"}),Object(r.jsx)(rt,{className:"AuthScreen-title",children:"WhatsApp"})]}),Object(r.jsxs)(m,{children:[Object(r.jsx)(b.b,{exact:!0,path:"/sign-in",component:Jn}),Object(r.jsx)(b.b,{exact:!0,path:"/sign-up",component:Wn})]}),a]})},it=e(102),ot=e(217),ut=e(88),st=e.n(ut),dt=e(134),lt=e.n(dt);function bt(){var n=Object(f.a)(["\n  mutation RemoveChat($chatId: ID!) {\n    removeChat(chatId: $chatId)\n  }\n"]);return bt=function(){return n},n}function ft(){var n=Object(f.a)(["\n  color: var(--primary-text) !important;\n"]);return ft=function(){return n},n}function jt(){var n=Object(f.a)(["\n  line-height: 56px;\n"]);return jt=function(){return n},n}function ht(){var n=Object(f.a)(["\n  height: 40px;\n  width: 40px;\n  margin-top: 3px;\n  margin-left: -22px;\n  object-fit: cover;\n  padding: 5px;\n  border-radius: 50%;\n"]);return ht=function(){return n},n}function pt(){var n=Object(f.a)(["\n  flex: 1;\n  display: flex;\n  justify-content: flex-end;\n"]);return pt=function(){return n},n}function vt(){var n=Object(f.a)(["\n  svg {\n    color: var(--primary-text);\n  }\n"]);return vt=function(){return n},n}function gt(){var n=Object(f.a)(["\n  padding: 0;\n  display: flex;\n  flex-direction: row;\n  background-color: var(--primary-bg);\n  color: var(--primary-text);\n"]);return gt=function(){return n},n}var Ot=Object(j.b)(ot.a)(gt()),mt=Object(j.b)($n.a)(vt()),xt=j.b.div(pt()),yt=j.b.img(ht()),Ct=j.b.div(jt()),wt=Object(j.b)($n.a)(ft()),kt=(k()(bt()),function(n){var t,e=n.chat,a=n.history,c=(t={variables:{chatId:e.id},update:function(n,t){var e=t.data;e&&e.removeChat&&yn(n,e.removeChat)}},d.useMutation(un,t)),u=Object(x.a)(c,1)[0],s=Object(i.useCallback)((function(){u().then((function(){a.replace("/chats")}))}),[u,a]),l=Object(i.useCallback)((function(){a.replace("/chats")}),[a]);return Object(r.jsxs)(Ot,{children:[Object(r.jsx)(mt,{"data-testid":"back-button",onClick:l,children:Object(r.jsx)(st.a,{})}),e&&e.picture&&e.name&&Object(r.jsxs)(o.a.Fragment,{children:[Object(r.jsx)(yt,{"data-testid":"chat-picture",src:e.picture}),Object(r.jsx)(Ct,{"data-testid":"chat-name",children:e.name})]}),Object(r.jsx)(xt,{children:Object(r.jsx)(wt,{"data-testid":"delete-button",onClick:s,children:Object(r.jsx)(lt.a,{})})})]})}),Mt=e(135),It=e.n(Mt);function St(){var n=Object(f.a)(["\n  min-width: 50px !important;\n  width: 50px !important;\n  border-radius: 999px !important;\n  background-color: var(--primary-bg) !important;\n  margin: 0 5px !important;\n  margin-right: 0 !important;\n  color: white !important;\n  padding-left: 20px !important;\n\n  svg {\n    margin-left: -3px;\n  }\n"]);return St=function(){return n},n}function $t(){var n=Object(f.a)(["\n  width: calc(100% - 50px);\n  border: none;\n  border-radius: 999px;\n  padding: 10px;\n  padding-left: 20px;\n  padding-right: 20px;\n  font-size: 15px;\n  outline: none;\n  box-shadow: 0 1px silver;\n  font-size: 18px;\n  line-height: 45px;\n"]);return $t=function(){return n},n}function qt(){var n=Object(f.a)(["\n  display: flex;\n  height: 50px;\n  padding: 5px;\n  width: calc(100% - 10px);\n"]);return qt=function(){return n},n}var At=j.b.div(qt()),Dt=j.b.input($t()),Ft=Object(j.b)($n.a)(St()),Rt=function(n){var t=n.onSendMessage,e=Object(i.useState)(""),a=Object(x.a)(e,2),c=a[0],o=a[1],u=function(){c&&(o(""),"function"===typeof t&&t(c))};return Object(r.jsxs)(At,{children:[Object(r.jsx)(Dt,{"data-testid":"message-input",type:"text",placeholder:"Type a message",value:c,onKeyPress:function(n){13===n.charCode&&u()},onChange:function(n){var t=n.target;o(t.value)}}),Object(r.jsx)(Ft,{"data-testid":"send-button",variant:"contained",color:"primary",onClick:u,children:Object(r.jsx)(It.a,{})})]})},Ut=e(89),Et=function(n){var t=n.ref,e=n.hasMore,r=n.onLoadMore,a=Object(i.useState)(!1),c=Object(x.a)(a,2),o=c[0],u=c[1],s=Object(i.useCallback)((function(){0===t.current.scrollTop&&!1===o&&e&&u(!0)}),[t,o,e]);Object(i.useEffect)((function(){var n=t.current;if(n)return n.addEventListener("scroll",s),function(){n.removeEventListener("scroll",s)}}),[t,s]),Object(i.useEffect)((function(){o&&r()}),[o,r]);var d=Object(i.useCallback)((function(){u(!1)}),[]);return[o,d]};function _t(){var n=Object(f.a)(["\n  position: absolute;\n  bottom: 2px;\n  right: 7px;\n  color: gray;\n  font-size: 12px;\n"]);return _t=function(){return n},n}function Lt(){var n=Object(f.a)(["\n  padding: 5px 7px;\n  word-wrap: break-word;\n\n  &::after {\n    content: ' \\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0\\00a0';\n    display: inline;\n  }\n"],["\n  padding: 5px 7px;\n  word-wrap: break-word;\n\n  &::after {\n    content: ' \\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0\\\\00a0';\n    display: inline;\n  }\n"]);return Lt=function(){return n},n}function Pt(){var n=Object(f.a)(["\n          float: left;\n          background-color: #fff;\n\n          &::before {\n            left: -11px;\n            background-image: url(/assets/message-other.png);\n          }\n        "]);return Pt=function(){return n},n}function Qt(){var n=Object(f.a)(["\n          float: right;\n          background-color: #dcf8c6;\n\n          &::before {\n            right: -11px;\n            background-image: url(/assets/message-mine.png);\n          }\n        "]);return Qt=function(){return n},n}function zt(){var n=Object(f.a)(["\n  display: inline-block;\n  position: relative;\n  max-width: 100%;\n  border-radius: 7px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);\n  margin-top: 10px;\n  margin-bottom: 10px;\n  clear: both;\n\n  &::after {\n    content: '';\n    display: table;\n    clear: both;\n  }\n\n  &::before {\n    content: '';\n    position: absolute;\n    bottom: 3px;\n    width: 12px;\n    height: 19px;\n    background-position: 50% 50%;\n    background-repeat: no-repeat;\n    background-size: contain;\n  }\n\n  ","\n"]);return zt=function(){return n},n}function Nt(){var n=Object(f.a)(["\n  height: 30px;\n  line-height: 30px;\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  text-align: center;\n"]);return Nt=function(){return n},n}function Tt(){var n=Object(f.a)(["\n  position: relative;\n  display: block;\n  flex: 2;\n  overflow-y: overlay;\n  padding: 0 15px;\n"]);return Tt=function(){return n},n}var Ht=j.b.div(Tt()),Bt=j.b.div(Nt()),Gt=j.b.div(zt(),(function(n){return n.isMine?Object(j.a)(Qt()):Object(j.a)(Pt())})),Jt=j.b.div(Lt()),Wt=j.b.div(_t()),Kt=function(n){var t=n.messages,e=n.loadMore,a=n.hasMore,c=Object(i.useRef)(null),o=Et({onLoadMore:e,hasMore:a,ref:c}),s=Object(x.a)(o,2),d=s[0],l=s[1],b=function(n){var t=Object(i.useState)(),e=Object(x.a)(t,2),r=e[0],a=e[1];return Object(i.useCallback)((function(t){if(n.current){var e=u.findDOMNode(n.current),c=!t&&r?r.height:e.clientHeight;e.scrollTop=e.scrollHeight-c,r&&e.scrollTop!==r.top&&a({top:e.scrollTop,height:e.scrollHeight})}}),[n,r])}(c);return Object(i.useEffect)((function(){c.current&&(d?(l(),b()):b(!0))}),[t.length,c,d,l,b]),Object(r.jsxs)(Ht,{ref:c,children:[d&&Object(r.jsx)(Bt,{children:"Loading more messages..."}),t.map((function(n){return Object(r.jsxs)(Gt,{"data-testid":"message-item",isMine:n.isMine,children:[Object(r.jsx)(Jt,{"data-testid":"message-content",children:n.content}),Object(r.jsx)(Wt,{"data-testid":"message-date",children:Object(Ut.a)(n.createdAt,"HH:mm")})]},n.id)}))]})};function Xt(){var n=Object(f.a)(["\n  mutation AddMessage($chatId: ID!, $content: String!) {\n    addMessage(chatId: $chatId, content: $content) {\n      ...Message\n    }\n  }\n  ","\n"]);return Xt=function(){return n},n}function Vt(){var n=Object(f.a)(["\n  query GetChat($chatId: ID!, $limit: Int!, $after: Float) {\n    chat(chatId: $chatId) {\n      ...FullChat\n    }\n  }\n  ","\n"]);return Vt=function(){return n},n}function Yt(){var n=Object(f.a)(["\n  background: url(/assets/chat-background.jpg);\n  display: flex;\n  flex-flow: column;\n  height: 100vh;\n"]);return Yt=function(){return n},n}var Zt=j.b.div(Yt()),ne=(k()(Vt(),F),k()(Xt(),I),o.a.createContext({after:0,limit:20,setAfter:function(n){},reset:function(){}})),te=function(){var n=Object(i.useContext)(ne);return Object(i.useEffect)((function(){return function(){n.reset()}}),[n]),n},ee=function(n){var t=n.children,e=Object(i.useState)(null),a=Object(x.a)(e,2),c=a[0],o=a[1];return Object(r.jsx)(ne.Provider,{value:{limit:20,after:c,setAfter:o,reset:function(){return o(null)}},children:t})},re=function(n){var t,e=n.history,a=n.chatId,c=te(),o=c.after,u=c.limit,s=c.setAfter,l=(t={variables:{chatId:a,after:o,limit:u}},d.useQuery(sn,t)),f=l.data,j=l.loading,h=l.fetchMore,p=function(n){return d.useMutation(dn,n)}(),v=Object(x.a)(p,1)[0],g=Object(i.useCallback)((function(n){return void 0===f||null===f.chat?null:void v({variables:{chatId:a,content:n},optimisticResponse:{__typename:"Mutation",addMessage:{__typename:"Message",id:Math.random().toString(36).substr(2,9),createdAt:new Date,isMine:!0,chat:{__typename:"Chat",id:a},content:n}},update:function(n,t){var e=t.data;e&&e.addMessage&&mn(n,e.addMessage)}})}),[f,a,v]);if(Object(i.useEffect)((function(){o&&h({variables:{after:o,limit:u},updateQuery:function(n,t){var e=t.fetchMoreResult,r=[].concat(Object(it.a)(e.chat.messages.messages),Object(it.a)(n.chat.messages.messages));return Object(y.a)(Object(y.a)({},n),{},{chat:Object(y.a)(Object(y.a)({},n.chat),{},{messages:Object(y.a)(Object(y.a)({},e.chat.messages),{},{messages:r})})})}})}),[o,u,h]),void 0===f)return null;var O=f.chat;return j||null===O?null:O?Object(r.jsxs)(Zt,{children:[(null===O||void 0===O?void 0:O.id)&&Object(r.jsx)(kt,{chat:O,history:e}),(null===O||void 0===O?void 0:O.messages)&&Object(r.jsx)(Kt,{messages:O.messages.messages,hasMore:O.messages.hasMore,loadMore:function(){return s(O.messages.cursor)}}),Object(r.jsx)(Rt,{onSendMessage:g})]}):Object(r.jsx)(b.a,{to:"/chats"})},ae=function(n){var t=n.history,e=n.chatId;return Object(r.jsx)(ee,{children:Object(r.jsx)(re,{history:t,chatId:e})})},ce=e(136),ie=e.n(ce);function oe(){var n=Object(f.a)(["\n  color: var(--primary-text) !important;\n"]);return oe=function(){return n},n}function ue(){var n=Object(f.a)(["\n  flex: 1;\n"]);return ue=function(){return n},n}function se(){var n=Object(f.a)(["\n  display: flex;\n  background-color: var(--primary-bg);\n  color: var(--primary-text);\n  font-size: 20px;\n  line-height: 40px;\n"]);return se=function(){return n},n}var de=Object(j.b)(ot.a)(se()),le=j.b.div(ue()),be=Object(j.b)($n.a)(oe()),fe=function(n){var t=n.history,e=In(),a=Object(i.useCallback)((function(){e().then((function(){t.replace("/sign-in")}))}),[t,e]);return Object(r.jsxs)(de,{children:[Object(r.jsx)(le,{children:"Whatsapp Clone"}),Object(r.jsx)(be,{"data-testid":"sign-out-button",onClick:a,children:Object(r.jsx)(ie.a,{})})]})},je=e(215),he=e(218);function pe(){var n=Object(f.a)(["\n  position: absolute;\n  color: gray;\n  top: 20px;\n  right: 0;\n  font-size: 13px;\n"]);return pe=function(){return n},n}function ve(){var n=Object(f.a)(["\n  color: gray;\n  font-size: 15px;\n  margin-top: 5px;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n"]);return ve=function(){return n},n}function ge(){var n=Object(f.a)(["\n  margin-top: 5px;\n"]);return ge=function(){return n},n}function Oe(){var n=Object(f.a)(["\n  width: calc(100% - 60px);\n  height: 46px;\n  padding: 15px 0;\n  margin-left: 10px;\n  border-bottom: 0.5px solid silver;\n  position: relative;\n"]);return Oe=function(){return n},n}function me(){var n=Object(f.a)(["\n  height: 50px;\n  width: 50px;\n  object-fit: cover;\n  border-radius: 50%;\n"]);return me=function(){return n},n}function xe(){var n=Object(f.a)(["\n  height: 76px;\n  padding: 0 15px;\n  display: flex;\n"]);return xe=function(){return n},n}function ye(){var n=Object(f.a)(["\n  padding: 0 !important;\n"]);return ye=function(){return n},n}function Ce(){var n=Object(f.a)(["\n  height: calc(100% - 56px);\n  overflow-y: overlay;\n"]);return Ce=function(){return n},n}var we=j.b.div(Ce()),ke=Object(j.b)(je.a)(ye()),Me=Object(j.b)(he.a)(xe()),Ie=j.b.img(me()),Se=j.b.div(Oe()),$e=j.b.div(ge()),qe=j.b.div(ve()),Ae=j.b.div(pe()),De=function(n){var t,e=n.history,a=Object(i.useCallback)((function(n){e.push("chats/".concat(n.id))}),[e]),c=function(){var n=Object(d.useApolloClient)(),t=te(),e=t.limit,r=t.after;return function(t){n.query({query:sn,variables:{chatId:t,after:r,limit:e}})}}(),u=d.useQuery(jn,t).data;if(void 0===u||void 0===u.chats)return null;var s=u.chats;return Object(r.jsx)(we,{children:Object(r.jsx)(ke,{children:s.map((function(n){return Object(r.jsxs)(Me,{"data-testid":"chat",button:!0,onClick:a.bind(null,n),onMouseEnter:function(){c(n.id)},children:[Object(r.jsx)(Ie,{"data-testid":"picture",src:n.picture,alt:"Profile"}),Object(r.jsxs)(Se,{children:[Object(r.jsx)($e,{"data-testid":"name",children:n.name}),n.lastMessage&&Object(r.jsxs)(o.a.Fragment,{children:[Object(r.jsx)(qe,{"data-testid":"content",children:n.lastMessage.content}),Object(r.jsx)(Ae,{"data-testid":"date",children:Object(Ut.a)(n.lastMessage.createdAt,"HH:mm")})]})]})]},n.id)}))})})},Fe=e(137),Re=e.n(Fe);function Ue(){var n=Object(f.a)(["\n  query UsersList {\n    users {\n      ...User\n    }\n  }\n  ","\n"]);return Ue=function(){return n},n}function Ee(){var n=Object(f.a)(["\n  padding-left: 15px;\n  font-weight: bold;\n"]);return Ee=function(){return n},n}function _e(){var n=Object(f.a)(["\n  height: 50px;\n  width: 50px;\n  object-fit: cover;\n  border-radius: 50%;\n"]);return _e=function(){return n},n}function Le(){var n=Object(f.a)(["\n  position: relative;\n  padding: 7.5px 15px;\n  display: flex;\n  cursor: pinter;\n"]);return Le=function(){return n},n}function Pe(){var n=Object(f.a)(["\n  padding: 0;\n"]);return Pe=function(){return n},n}var Qe=Object(j.b)(je.a)(Pe()),ze=Object(j.b)(he.a)(Le()),Ne=j.b.img(_e()),Te=j.b.div(Ee()),He=(k()(Ue(),U),function(n){var t,e=n.onUserPick,a=void 0===e?function(n){}:e,c=d.useQuery(ln,t),i=c.data,u=c.loading;if(void 0===i)return null;var s=i.users;return Object(r.jsx)(Qe,{children:!u&&s.map((function(n){return Object(r.jsx)(ze,{"data-testid":"user",onClick:a.bind(null,n),button:!0,children:null!==n&&null!==n.picture&&Object(r.jsxs)(o.a.Fragment,{children:[Object(r.jsx)(Ne,{"data-testid":"picture",src:n.picture}),Object(r.jsx)(Te,{"data-testid":"name",children:n.name})]})},n.id)}))})});function Be(){var n=Object(f.a)(["\n  position: fixed;\n  right: 10px;\n  bottom: 10px;\n \n  button {\n    min-width: 50px;\n    width: 50px;\n    height: 50px;\n    border-radius: 999px;\n    background-color: var(--secondary-bg);\n    color: white;\n  }\n"]);return Be=function(){return n},n}var Ge=j.b.div(Be()),Je=function(n){var t=n.history,e=function(){var n=Object(d.useApolloClient)();return function(){n.query({query:ln})}}();return Object(r.jsx)(Ge,{onMouseEnter:function(){return e()},children:Object(r.jsx)($n.a,{"data-testid":"new-chat-button",variant:"contained",color:"secondary",onClick:function(){t.push("/new-chat")},children:Object(r.jsx)(Re.a,{})})})};function We(){var n=Object(f.a)(["\n  height: 100vh;\n"]);return We=function(){return n},n}var Ke=j.b.div(We()),Xe=function(n){var t=n.history;return Object(r.jsxs)(Ke,{children:[Object(r.jsx)(fe,{history:t}),Object(r.jsx)(De,{history:t}),Object(r.jsx)(Je,{history:t})]})};function Ve(){var n=Object(f.a)(["\n  flex: 1;\n"]);return Ve=function(){return n},n}function Ye(){var n=Object(f.a)(["\n  svg {\n    color: var(--primary-text);\n  }\n"]);return Ye=function(){return n},n}function Ze(){var n=Object(f.a)(["\n  display: flex;\n  background-color: var(--primary-bg);\n  color: var(--primary-text);\n  font-size: 20px;\n  line-height: 40px;\n"]);return Ze=function(){return n},n}var nr=Object(j.b)(ot.a)(Ze()),tr=Object(j.b)($n.a)(Ye()),er=j.b.div(Ve()),rr=function(n){var t=n.history,e=Object(i.useCallback)((function(){t.replace("/chats")}),[t]);return Object(r.jsxs)(nr,{children:[Object(r.jsx)(tr,{"data-testid":"back-button",onClick:e,children:Object(r.jsx)(st.a,{})}),Object(r.jsx)(er,{children:"Create Chat"})]})};function ar(){var n=Object(f.a)(["\n  mutation AddChat($recipientId: ID!) {\n    addChat(recipientId: $recipientId) {\n      ...Chat\n    }\n  }\n  ","\n"]);return ar=function(){return n},n}function cr(){var n=Object(f.a)(["\n  height: calc(100% - 56px);\n"]);return cr=function(){return n},n}function ir(){var n=Object(f.a)(["\n  height: calc(100% - 56px);\n  overflow-y: overlay;\n"]);return ir=function(){return n},n}j.b.div(ir()),Object(j.b)(He)(cr());k()(ar(),$);var or=function(n){var t,e=n.history,a=d.useMutation(on,t),c=Object(x.a)(a,1)[0],o=Object(i.useCallback)((function(n){return c({optimisticResponse:{__typename:"Mutation",addChat:{__typename:"Chat",id:Math.random().toString(36).substr(2,9),name:n.name,picture:n.picture,lastMessage:null}},variables:{recipientId:n.id},update:function(n,t){var e=t.data;e&&e.addChat&&xn(n,e.addChat)}}).then((function(n){n&&null!==n.data&&e.push("/chats/".concat(n.data.addChat.id))}))}),[c,e]);return Object(r.jsxs)("div",{children:[Object(r.jsx)(rr,{history:e}),Object(r.jsx)(He,{onUserPick:o})]})},ur=function(){return Object(r.jsx)(b.a,{to:"/chats"})},sr=function(){return Object(r.jsxs)(l.a,{children:[Object(r.jsxs)(m,{children:[Object(r.jsx)(b.b,{exact:!0,path:"/sign-(in|up)",component:ct}),Object(r.jsx)(b.b,{exact:!0,path:"/chats",component:wn(Xe)}),Object(r.jsx)(b.b,{exact:!0,path:"/chats/:chatId",component:wn((function(n){var t=n.match,e=n.history;return Object(r.jsx)(ae,{chatId:t.params.chatId,history:e})}))}),Object(r.jsx)(b.b,{exact:!0,path:"/new-chat",component:wn(or)})]}),Object(r.jsx)(b.b,{exact:!0,path:"/",render:ur})]})},dr=function(n){n&&n instanceof Function&&e.e(3).then(e.bind(null,221)).then((function(t){var e=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;e(n),r(n),a(n),c(n),i(n)}))},lr=e(142),br=e(140),fr=e(6),jr=e(141),hr=e(35),pr="http://localhost:4000/graphql",vr=pr.replace(/^https?/,"ws"),gr=new br.a({uri:pr,credentials:"include"}),Or=new jr.a({uri:vr,options:{reconnect:!0}}),mr=Object(hr.d)((function(n){var t=n.query,e=Object(fr.l)(t),r=e.kind,a=e.operation;return"OperationDefinition"===r&&"subscription"===a}),Or,gr),xr=hr.a.from([mr]),yr=new C.a,Cr=new lr.a({link:xr,cache:yr}),wr=Object(a.a)({palette:{primary:{main:"#2c6157"},secondary:{main:"#6fd056"}}});s.a.render(Object(r.jsx)(o.a.StrictMode,{children:Object(r.jsx)(c.a,{theme:wr,children:Object(r.jsx)(d.ApolloProvider,{client:Cr,children:Object(r.jsx)(sr,{})})})}),document.getElementById("root")),dr(console.log)}},[[182,1,2]]]);
//# sourceMappingURL=main.c2b0cf57.chunk.js.map